<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles.css">
    <title>Barry's Blog</title>
</head>
<body>
    <div id="modalOverlay" class="modal-overlay"></div>
    
    <div id="modal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Speak your Mind...</h2>
            <form id="blogForm" action="/posts" method="POST">
                <textarea id="blogText" name="content" placeholder="Free type your blog here..." required></textarea>
                <button type="submit">Post Blog</button>
            </form>
        </div>
    </div>

    <nav>
        <h1>Gleesh's Corner</h1>
        <a href="/about">About</a>
    </nav>
    <div id="subheader">
        <h2>Welcome to Gleesh's Corner</h2>
        <button id="newBlogBtn" class="new-blog-btn">New Blog</button>
    </div>

    <!-- Display Blogs -->
    <div class="blogs-container">
        <% if (blogs && blogs.length > 0) { %>
            <% blogs.forEach(blog => { %>
                <div class="blog-post">
                    <div class ="blog-header">
                        <button class="edit-btn" data-id="<%= blog._id %>">Edit</button>
                        <button class="delete-btn" data-id="<%= blog._id %>">Delete</button>
                    </div>
                    <p><%= blog.content %></p>
                    <p class="timestamp"><%= new Date(blog.timestamp).toLocaleString() %></p>
                </div>
            <% }); %>
        <% } %>
    </div>

    <script>
        const modal = document.getElementById('modal');
        const overlay = document.getElementById('modalOverlay');
        const newBlogBtn = document.getElementById('newBlogBtn');
        const closeBtn = document.querySelector('.close');
        const blogForm = document.getElementById('blogForm');
        const editButtons = document.querySelectorAll('.edit-btn');
        const deleteButtons = document.querySelectorAll('.delete-btn');
        // Open modal
        newBlogBtn.addEventListener('click', () => {
            modal.style.display = 'block';
            overlay.style.display = 'block';
        });

        // Close modal
        closeBtn.addEventListener('click', () => {
            modal.style.display = 'none';
            overlay.style.display = 'none';
        });

        overlay.addEventListener('click', () => {
            modal.style.display = 'none';
            overlay.style.display = 'none';
        });

        // Submit form
        blogForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const formData = new FormData(blogForm);
            fetch('/posts', {
                method: 'POST',
                body: formData
            }).then(() => {
                location.reload();
            });
        });

        // Edit blog
        editButtons.forEach(button => {
            button.addEventListener('click', () => {
                const blogId = button.getAttribute('data-id');
                const blogContent = button.parentElement.nextElementSibling.textContent;
                document.getElementById('blogText').value = blogContent;
                modal.style.display = 'block';
                overlay.style.display = 'block';

                blogForm.onsubmit = (e) => {
                    e.preventDefault();
                    const formData = new FormData(blogForm);
                    fetch(`/posts/${blogId}`, {
                        method: 'PUT',
                        body: formData
                    }).then(() => {
                        location.reload();
                    });
                };
            });
        });

        // Delete blog
        deleteButtons.forEach(button => {
            button.addEventListener('click', () => {
                const blogId = button.getAttribute('data-id');
                if (confirm('Are you sure you want to delete this blog?')) {
                    fetch(`/posts/${blogId}`, {
                        method: 'DELETE'
                    }).then(() => {
                        location.reload();
                    });
                }
            });
        });
        
        
    </script>
</body>
</html>